<!doctype html>
<html lang="zh">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<title>姹夎鍙ら煶鎵嬪唽 鈥?璇嶅吀</title>
	<link rel="icon" href="https://pic1.imgdb.cn/item/698dc2031d67521e9b492114.png" type="image/png">
	<link rel="prefetch" href="/assets/articles-8TKf3Hn8.html" as="document">
	<link rel="prefetch" href="/assets/article-BQf-_N5W.html" as="document">
	<link rel="prefetch" href="data:text/markdown;base64,77u/IyDnq5nlhoXmlofnq6Dnm67lvZUNCg0KLSBb5bu656uZ6K+05piO77ya5LuO5LiA5Lu96LaF5aSnVFhU5Yiw5Y+v5qOA57Si55qE5Y+k6Z+z6K+N5YW4572R56uZXShhcnRpY2xlcy9vdmVydmlldy5tZCkgfCAyMDI2LTAyLTI0IHwgVGFraW9uIEtyb3NsaW4gfCDorrLov7Dlu7rnq5nliqjmnLrjgIHliIbniYfmlrnmoYjjgIHmo4DntKLkuI7kuqTkupLorr7orqHvvIzku6Xlj4rlpoLkvZXorqnlj6Tpn7PotYTmlpnmm7TmmJPorr/pl67jgIINCi0gW+acgOaWsOeJiOacrOWKn+iDveWFqOino++8mue7n+S4gFVJ44CB56e75Yqo56uv5L6n5qCP44CB5LiK5LiL56+H44CB5LqM57u056CB5YiG5Lqr5LiOTWFya2Rvd27lhYPkv6Hmga9dKGFydGljbGVzL3BvbHlwaG9ueS5tZCkgfCAyMDI2LTAyLTI0IHwgVGFraW9uIEtyb3NsaW4gfCDlrozmlbTor7TmmI7mnKzova7mm7TmlrDlubbnu5nlh7rku6PnoIHpq5jkuq7jgIFMYVRlWOOAgUhUTUzltYzlhaXnrYnlsZXnpLrnpLrkvovjgIINCg==" as="fetch" crossorigin>
	<link rel="shortcut icon" href="https://pic1.imgdb.cn/item/698dc2031d67521e9b492114.png">
	<link rel="apple-touch-icon" href="https://pic1.imgdb.cn/item/698dc2031d67521e9b492114.png">
	<link rel="stylesheet" type="text/css" href="姹夎鍙ら煶鎵嬪唽.css">
	<script src="s2t_map.js"></script>
	<style>
		:root{--bar-height:64px;--footer-height:50px;--bar-pad-x:18px;--bar-pad-y:12px;--glass-bg:rgba(255,255,255,0.35);--glass-border:1px solid rgba(208,215,230,0.72);--bottom-safe:calc(var(--footer-height) + 72px);--font-sans:'HarmonyOS Sans SC','HarmonyOS Sans','PingFang SC','Microsoft YaHei','Noto Sans CJK SC','Segoe UI',sans-serif;--btn-radius:10px}
		body{margin:0 !important;font-family:var(--font-sans); line-height:1.6; color:#222; background:#ecf2f9; padding-top:var(--bar-height); padding-bottom:var(--bottom-safe)}
			.topbar{position:fixed;top:0;left:0;right:0;z-index:1000;background:rgba(255,255,255,0.35);-webkit-backdrop-filter:blur(15px) saturate(130%);backdrop-filter:blur(15px) saturate(130%);padding:var(--bar-pad-y) var(--bar-pad-x);box-shadow:0 2px 12px rgba(11,59,102,0.08);height:var(--bar-height);box-sizing:border-box;border-bottom:1px solid rgba(230,233,239,0.6);display:flex;align-items:center;gap:12px}
		.brand{font-weight:700;font-size:18px;color:#2b6cb0;white-space:nowrap}
		.search-wrap{flex:1;display:flex;align-items:center;gap:8px}
		#search-input{flex:1;padding:10px 12px;border:1px solid #d0d7e6;border-radius:8px;background:var(--glass-bg);font-size:16px;transition:border-color 0.2s,box-shadow 0.2s;-webkit-backdrop-filter:blur(12px) saturate(125%);backdrop-filter:blur(12px) saturate(125%)}
		#search-input:focus{outline:none;border-color:#2b6cb0;box-shadow:0 0 0 2px rgba(43,108,176,0.1)}
		#search-mode{padding:10px 10px;border:1px solid #d0d7e6;border-radius:8px;background:var(--glass-bg);font-size:14px;cursor:pointer;transition:border-color 0.2s,box-shadow 0.2s;color:#222;-webkit-backdrop-filter:blur(12px) saturate(125%);backdrop-filter:blur(12px) saturate(125%)}
		#search-mode:focus{outline:none;border-color:#2b6cb0;box-shadow:0 0 0 2px rgba(43,108,176,0.1)}
		#search-btn{padding:10px 16px;background:var(--glass-bg);color:#2b6cb0;border:var(--glass-border);border-radius:var(--btn-radius);cursor:pointer;transition:all 0.2s;font-weight:500;min-width:60px;-webkit-backdrop-filter:blur(12px) saturate(125%);backdrop-filter:blur(12px) saturate(125%);}
		#search-btn:hover{background:rgba(43,108,176,0.3);transform:translateY(-1px);box-shadow:0 2px 8px rgba(43,108,176,0.15)}
		#search-btn:active{transform:translateY(0)}
		#search-input.no-result{animation:shake .28s}
		@keyframes shake{0%{transform:translateX(0)}25%{transform:translateX(-6px)}50%{transform:translateX(6px)}75%{transform:translateX(-4px)}100%{transform:translateX(0)}}
		#entries{max-width:980px;margin:40px auto;margin-left:520px;margin-right:30px;padding:12px}
		.main-container{max-width:980px;margin:40px auto;padding:0 20px}
		h1{font-size:28px;margin:14px 0 6px;color:#0b3b66}
		.polyphony-note{display:inline-block;margin:0 0 8px;padding:2px 8px;border-radius:999px;background:rgba(43,108,176,0.12);color:#1f4f86;font-size:12px;line-height:1.5}
		.entry-note{margin:10px 0;padding:10px 12px;border-radius:10px;border:1px solid rgba(43,108,176,0.20);background:rgba(43,108,176,0.06);line-height:1.7}
		table{border-collapse:collapse;margin:4px 0 10px;background:var(--glass-bg);border:var(--glass-border);width:100%;border-radius:6px;overflow:hidden;backdrop-filter:blur(12px) saturate(125%)}
		th,td{padding:8px 10px;border:1px solid #eef2f8;text-align:left;font-size:14px}
		th{background:rgba(43,108,176,0.05);font-weight:600}
		caption{font-weight:600;text-align:left;padding:6px 10px}
		.highlighted{animation:highlight 1.2s ease;box-shadow:0 0 0 4px rgba(43,108,176,0.12)}
		@keyframes highlight{0%{background:#fff7e6}50%{background:#fffde8}100%{background:transparent}}
		.entry-card{position:relative;background:var(--glass-bg);border-radius:14px;padding:16px 18px;margin:14px 6px;box-shadow:0 10px 30px rgba(11,20,45,0.06);border:1px solid rgba(255,255,255,0.6);backdrop-filter:blur(10px) saturate(120%);transition:transform .28s ease,box-shadow .28s ease,opacity .36s ease;opacity:0;transform:translateY(12px) scale(.998);overflow:hidden}
		.entry-card.show{opacity:1;transform:none}
		.entry-card:hover{transform:translateY(-8px) scale(1.01);box-shadow:0 26px 54px rgba(11,20,45,0.10)}
		.copy-btn{position:absolute;top:10px;right:10px;padding:4px 9px;background:rgba(255,255,255,0.72);color:#2b6cb0;border:var(--glass-border);border-radius:var(--btn-radius);cursor:pointer;font-size:12px;opacity:.72;transition:all 0.2s;backdrop-filter:blur(12px) saturate(125%)}
		.entry-card:hover .copy-btn{opacity:1}
		.copy-btn:hover{background:rgba(255,255,255,0.75);transform:scale(1.05)}
		.copy-btn.copied{background:#4caf50;color:#fff}
		#jump-input{padding:8px 10px;border:1px solid #d0d7e6;border-radius:6px;background:#fff;font-size:14px;transition:border-color 0.2s}
		#jump-input:focus{outline:none;border-color:#2b6cb0;box-shadow:0 0 0 2px rgba(43,108,176,0.1)}
			.side-fab{position:fixed;right:30px;width:48px;height:48px;background:var(--glass-bg);color:#2b6cb0;border:var(--glass-border);border-radius:var(--btn-radius);cursor:pointer;display:flex;align-items:center;justify-content:center;z-index:1200;opacity:0;transform:translateY(8px);pointer-events:none;transition:opacity .24s ease,transform .24s ease,background-color .22s ease,box-shadow .22s ease;box-shadow:0 4px 12px rgba(43,108,176,0.2);-webkit-backdrop-filter:blur(16px) saturate(140%);backdrop-filter:blur(16px) saturate(140%);padding:0;text-decoration:none}
			.side-fab:hover{background:rgba(43,108,176,0.3);transform:translateY(0);box-shadow:0 6px 16px rgba(43,108,176,0.3)}
		.side-fab.show{opacity:1;transform:none;pointer-events:auto}
		.page-btn{opacity:1 !important;transform:none !important;pointer-events:auto !important}
		.side-fab svg{width:18px;height:18px;fill:none !important;stroke:currentColor;stroke-width:2.5;stroke-linecap:round;stroke-linejoin:round}
		#scroll-to-top{bottom:calc(var(--footer-height) + 90px)}
		#scroll-to-bottom{bottom:calc(var(--footer-height) + 30px)}
		#scroll-to-bottom svg{transform:rotate(180deg)}
		#page-prev{bottom:calc(var(--footer-height) + 150px)}
		#page-next{bottom:calc(var(--footer-height) + 210px)}
		.page-btn{right:20px}
		#share-btn:hover{background:rgba(43,108,176,0.3);transform:translateY(-2px);box-shadow:0 4px 12px rgba(43,108,176,0.2)}
		#share-btn.copied{background:rgba(76,175,80,0.2);color:#4caf50;border-color:rgba(76,175,80,0.4)}
		#sidebar{position:fixed;left:24px;top:80px;width:470px;z-index:500;transition:all 0.3s ease}
		#sidebar-mobile-toggle{display:none !important;position:fixed;left:12px;right:auto;bottom:calc(var(--footer-height) + 30px);z-index:1300;width:48px;height:48px;padding:0;border-radius:var(--btn-radius);opacity:1;pointer-events:auto}
		#articles-mobile-btn{display:none !important;position:fixed;right:16px;bottom:280px;z-index:1300;width:48px;height:48px;border-radius:var(--btn-radius);opacity:1 !important;pointer-events:auto !important;transform:none !important;text-decoration:none}
		.sidebar-overlay{display:none}
		.sidebar-card{padding:12px;border-radius:16px;background:rgba(255,255,255,0.46);border:1px solid rgba(255,255,255,0.72);box-shadow:0 16px 40px rgba(16,34,58,0.10);-webkit-backdrop-filter:blur(18px) saturate(130%);backdrop-filter:blur(18px) saturate(130%)}
		.sidebar-cover-wrap{position:relative;overflow:hidden;border-radius:12px}
		.sidebar-cover-wrap::after{content:none}
		#sidebar img{width:100%;height:138px;border-radius:12px;box-shadow:0 2px 8px rgba(43,108,176,0.12);object-fit:cover;transition:all 0.4s ease;display:block}
		#sidebar img:hover{transform:scale(1.04);filter:saturate(1.1)}
		#sidebar #share-btn{width:100%;margin-top:10px;padding:9px;background:rgba(43,108,176,0.16);color:#1f4f86;border:1px solid rgba(43,108,176,0.26);border-radius:var(--btn-radius);cursor:pointer;font-weight:600;font-size:12px;transition:all 0.2s;-webkit-backdrop-filter:blur(8px) saturate(120%);backdrop-filter:blur(8px) saturate(120%)}
		#sidebar #share-btn:hover{background:rgba(43,108,176,0.25);transform:translateY(-1px);box-shadow:0 4px 12px rgba(43,108,176,0.2)}
		#sidebar #share-btn.copied{background:rgba(76,175,80,0.2);color:#2f7a3f;border-color:rgba(76,175,80,0.4)}
		.sidebar-slogan{margin:12px 4px 10px;color:#1f3f67;font-size:12px;line-height:1.55}
		.sidebar-section{margin-top:8px;padding-top:10px;border-top:1px dashed rgba(43,108,176,0.25)}
		.sidebar-section-title{font-size:12px;font-weight:700;color:#2b6cb0;display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
		#article-count{font-size:11px;color:#5f7ea1}
		#article-list{list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:8px}
		#article-list li{margin:0}
		#article-list a{display:block;padding:8px 10px;border-radius:10px;text-decoration:none;color:#1f3f67;background:rgba(255,255,255,0.42);border:1px solid rgba(208,215,230,0.72);transition:all .2s}
		#article-list a:hover{transform:translateX(2px);background:rgba(43,108,176,0.12);border-color:rgba(43,108,176,0.25)}
		.article-title{display:block;font-size:12px;font-weight:600;line-height:1.4}
		.article-meta{display:block;margin-top:3px;font-size:11px;color:#60758f}
		.article-loading{padding:8px 10px;border-radius:10px;background:rgba(255,255,255,0.42);font-size:12px;color:#60758f}
		.article-more{display:block;margin-top:8px;text-align:center;padding:8px 10px;border-radius:10px;text-decoration:none;color:#2b6cb0;background:rgba(43,108,176,0.10);border:1px solid rgba(43,108,176,0.25);transition:all .2s}
		.article-more:hover{transform:translateY(-1px);background:rgba(43,108,176,0.18)}
			footer.site-footer{position:fixed !important;left:0 !important;right:0 !important;bottom:0 !important;width:100% !important;max-width:none !important;z-index:1000 !important;margin:0 !important;border-radius:0 !important;background:var(--glass-bg) !important;-webkit-backdrop-filter:blur(18px) saturate(145%) !important;backdrop-filter:blur(18px) saturate(145%) !important;padding:8px 12px !important;height:var(--footer-height) !important;box-sizing:border-box !important;border-top:1px solid rgba(230,233,239,0.6) !important;border-left:0 !important;border-right:0 !important;border-bottom:0 !important;box-shadow:none !important;display:flex;align-items:center;justify-content:center;text-align:center;color:#666;font-size:13px}
		footer{background:var(--glass-bg) !important;border:var(--glass-border) !important;backdrop-filter:blur(12px) saturate(125%) !important}
		#share-btn,#jump-input{background:var(--glass-bg) !important;border:var(--glass-border) !important;backdrop-filter:blur(12px) saturate(125%) !important}
		.footer-content{display:flex;align-items:center;gap:8px;white-space:nowrap}
		.footer-text{display:flex;align-items:center;gap:6px}
		.footer-sep{opacity:.65}
		.footer-link{display:inline-flex;align-items:center;gap:4px;color:#2b6cb0;text-decoration:none;opacity:.85;transition:opacity .2s,transform .2s}
		.footer-link:hover{opacity:1;transform:translateY(-1px)}
		.footer-link svg{width:12px;height:12px;display:block}
			.footer-btn{display:inline-flex;align-items:center;justify-content:center;width:22px;height:22px;color:#2b6cb0;cursor:pointer;transition:opacity .2s,transform .2s,background-color .2s,color .2s;text-decoration:none;opacity:.78;border-radius:6px}
			.footer-btn:hover{opacity:1;transform:translateY(-1px);background:rgba(43,108,176,0.25);color:#2b6cb0}
		@supports not ((-webkit-backdrop-filter: blur(1px)) or (backdrop-filter: blur(1px))){
			.topbar,#search-input,#search-mode,#search-btn,.side-fab,.sidebar-card,#sidebar #share-btn,footer.site-footer{background:rgba(255,255,255,0.78) !important}
		}
		@media (min-width:769px){
			#sidebar-mobile-toggle{display:none !important}
		}
		@media (max-width:768px){
			:root{--bar-height:72px;--footer-height:64px}
			body{padding-top:102px !important;padding-bottom:300px !important}
			
			/* 椤堕儴鏍忎袱琛屽竷灞€ */
			.topbar{padding:0;background:transparent;backdrop-filter:none;border:0;box-shadow:none;height:0}
			.brand,.topbar-warning{display:none}
			.search-wrap{width:calc(100% - 24px);margin:0 auto;gap:8px;padding:6px 0 0}
			#search-input{height:40px;padding:0 12px;font-size:14px;line-height:40px;box-sizing:border-box;flex:1;background:rgba(255,255,255,0.52);border:1px solid rgba(208,215,230,0.82);-webkit-backdrop-filter:blur(12px) saturate(125%);backdrop-filter:blur(12px) saturate(125%);box-shadow:0 4px 14px rgba(11,59,102,0.08)}
			#search-btn{height:40px;padding:0 14px;font-size:14px;min-width:60px;box-sizing:border-box}
			
			/* 渚ц竟鏍忛殣钘?*/
			#sidebar-mobile-toggle{display:inline-flex;align-items:center;justify-content:center;gap:6px;opacity:1 !important;pointer-events:auto !important;transform:none !important}
			#articles-mobile-btn{display:inline-flex !important;align-items:center;justify-content:center}
			#sidebar-mobile-toggle{top:10px;left:10px;bottom:auto}
			#articles-mobile-btn{top:auto;right:16px;bottom:294px}
			.sidebar-overlay{display:block;position:fixed;inset:0;background:rgba(10,22,38,.32);backdrop-filter:blur(3px);z-index:490;opacity:0;pointer-events:none;transition:opacity .25s ease}
			#sidebar{display:block;left:12px;top:126px;width:min(92vw,470px);max-height:calc(100vh - 190px);overflow:auto;z-index:500;transform:translateX(-115%);opacity:0;pointer-events:none}
			body.sidebar-open #sidebar{transform:translateX(0);opacity:1;pointer-events:auto}
			body.sidebar-open .sidebar-overlay{opacity:1;pointer-events:auto}
			
			/* 鍐呭鍖哄煙閫傞厤 */
			.main-container{max-width:100% !important;margin:0 auto 20px !important;padding:0 12px !important}
			#entries{padding:0 12px !important;margin-left:0 !important;margin-right:0 !important}
			h1{font-size:22px;margin:10px 0 4px}
			
			/* 鍗＄墖閫傞厤 - 绉婚櫎 hover 鏁堟灉锛屽鍒舵寜閽缁堟樉绀?*/
			.entry-card{padding:14px 12px;margin:10px 0;border-radius:12px}
			.entry-card:hover{transform:none;box-shadow:0 10px 30px rgba(11,20,45,0.06)}
			.copy-btn{position:static;bottom:auto;right:auto;padding:8px 14px;font-size:13px;margin-top:10px;width:100%;text-align:center;opacity:1}
			.entry-card:hover .copy-btn{opacity:1}
			
			/* 琛ㄦ牸閫傞厤 */
			table{font-size:13px}
			th,td{padding:6px 8px}
			
			/* 鎮诞鎸夐挳閫傞厤 - 缁熶竴鏍峰紡 */
			.side-fab{right:16px !important;width:48px !important;height:48px !important}
			#scroll-to-top{bottom:114px !important}
			#scroll-to-bottom{bottom:54px !important}
			#page-prev{bottom:174px !important}
			#page-next{bottom:234px !important}
			.page-btn{right:16px !important}
			.side-fab svg{width:20px;height:20px}
			
			/* 椤佃剼閫傞厤 */
			footer.site-footer{inset:auto 12px 10px 12px !important;width:auto !important;max-width:none !important;height:64px !important;padding:10px 12px !important;border:1px solid rgba(230,233,239,0.6) !important;border-radius:14px !important;box-shadow:0 -2px 10px rgba(11,59,102,0.06) !important}
			footer.site-footer .footer-content{gap:8px}
			.footer-text{font-size:12px}
			.footer-btn{width:20px;height:20px}
			.footer-btn svg{width:18px;height:18px}
		}
	</style>
		<script>
	(function(){
		const INDEX_PATH = 'chunks/index.json';
		const CHUNK_URL = (n) => `chunks/part-${n}.html`;
		const CATALOG_PATH = 'articles/catalog.md';
		let indexData = null;
		let conv = null;
		let currentChunk = 0;
		let loaded = new Map();

		function loadScript(src){
			return new Promise((res,rej)=>{
				const s=document.createElement('script'); s.src=src; s.async=true; s.onload=()=>res(true); s.onerror=()=>rej(false); document.head.appendChild(s);
			});
		}

		async function ensureConverter(){
			console.log('鉁?浣跨敤鏈湴绠€绻佹槧灏勮〃 (s2t_map.js)');
			// 浣跨敤鍏ㄥ眬鐨?s2tMap锛堜粠 s2t_map.js 鍔犺浇锛?
			if(typeof s2tMap === 'undefined') {
				console.warn('鈿?s2tMap 鏈畾涔夛紝绛夊緟鍔犺浇...');
				// 绛夊緟 s2t_map.js 鍔犺浇
				let retry = 0;
				while(typeof s2tMap === 'undefined' && retry < 50) {
					await new Promise(r => setTimeout(r, 100));
					retry++;
				}
			}
			
			return {
				toS: (t)=>t, // 鏆備笉鏀寔绻佽浆绠€
				toT: (t)=>{
					// 绠€杞箒锛堜娇鐢ㄥ叏灞€鏄犲皠琛級
					if(typeof s2tMap === 'undefined') {
						console.warn('鈿?s2tMap 浠嶆湭瀹氫箟');
						return t;
					}
					let result = '';
					for(let i=0; i<t.length; i++){
						const char = t[i];
						result += s2tMap[char] || char;
					}
					return result;
				}
			};
		}

		async function fetchJSON(url){ try{ const r=await fetch(url, { cache: 'force-cache' }); if(!r.ok) throw 0; return await r.json(); }catch(e){ console.error('鍔犺浇澶辫触: '+url, e); return null } }

		function parseCatalogMarkdown(md){
			const lines = (md || '').split(/\r?\n/);
			const items = [];
			for(const rawLine of lines){
				const line = rawLine.trim();
				if(!line.startsWith('- ')) continue;
				const m = line.match(/^- \[(.+?)\]\((.+?)\)\s*\|\s*([^|]+?)\s*\|\s*([^|]+?)(?:\s*\|\s*(.+))?$/);
				if(!m) continue;
				items.push({
					title: m[1].trim(),
					path: m[2].trim(),
					date: m[3].trim(),
					author: m[4].trim(),
					summary: (m[5] || '').trim()
				});
			}
			return items;
		}

		function renderArticleList(items){
			const listEl = document.getElementById('article-list');
			const countEl = document.getElementById('article-count');
			if(!listEl || !countEl) return;

			countEl.textContent = `${items.length}绡嘸;
			if(!items.length){
				listEl.innerHTML = '<li class="article-loading">鏆傛棤鏂囩珷</li>';
				return;
			}

			listEl.innerHTML = items.map((item)=>{
				const href = `article.html?file=${encodeURIComponent(item.path)}`;
				const meta = [item.date, item.author].filter(Boolean).join(' 路 ');
				const title = (item.title || '').replace(/"/g, '&quot;');
				const summary = (item.summary || '').replace(/"/g, '&quot;');
				return `<li><a href="${href}" title="${summary}"><span class="article-title">${title}</span><span class="article-meta">${meta}</span></a></li>`;
			}).join('');
		}

		async function loadArticleCatalog(){
			try{
				const r = await fetch(CATALOG_PATH, { cache: 'force-cache' });
				if(!r.ok) throw new Error(`HTTP ${r.status}`);
				const text = await r.text();
				renderArticleList(parseCatalogMarkdown(text));
			}catch(e){
				console.error('鐩綍鍔犺浇澶辫触', e);
				renderArticleList([]);
			}
		}

		function formatCardForCopy(card, entryUrl){
			const blocks = [];
			const children = Array.from(card.children).filter((el)=>!el.classList.contains('copy-btn'));

			for(const el of children){
				const tag = el.tagName.toLowerCase();
				if(tag === 'br') continue;

				if(tag === 'h1'){
					const t = (el.textContent || '').trim();
					if(t) blocks.push(`銆?{t}銆慲);
					continue;
				}

				if(tag === 'table'){
					const tableLines = [];
					const caption = el.querySelector('caption')?.textContent?.trim();
					if(caption) tableLines.push(caption);
					const rows = el.querySelectorAll('tr');
					for(const row of rows){
						const cells = row.querySelectorAll('th,td');
						const rowText = Array.from(cells)
							.map((cell)=>cell.textContent?.replace(/\s+/g, ' ').trim() || '')
							.filter(Boolean)
							.join(' | ');
						if(rowText) tableLines.push(rowText);
					}
					if(tableLines.length) blocks.push(tableLines.join('\n'));
					continue;
				}

				if(tag === 'h4'){
					const t = (el.textContent || '').trim();
					if(t) blocks.push(t);
					continue;
				}

				if(tag === 'p' || tag === 'u' || tag === 'div'){
					const t = (el.textContent || '').replace(/\s+/g, ' ').trim();
					if(t) blocks.push(t);
				}
			}

			const cleaned = blocks.join('\n\n').replace(/\n{3,}/g, '\n\n').trim();
			return `${cleaned}\n\n鈥斺€?姹夎鍙ら煶鎵嬪唽\n${entryUrl}`;
		}

		function updateButtons(){
			const pagePrev = document.getElementById('page-prev');
			const pageNext = document.getElementById('page-next');
			if(pagePrev) {
				pagePrev.disabled = currentChunk === 0;
				pagePrev.style.opacity = currentChunk === 0 ? '0.4' : '1';
				pagePrev.style.pointerEvents = currentChunk === 0 ? 'none' : 'auto';
			}
			if(pageNext) {
				pageNext.disabled = currentChunk >= indexData.chunks - 1;
				pageNext.style.opacity = currentChunk >= indexData.chunks - 1 ? '0.4' : '1';
				pageNext.style.pointerEvents = currentChunk >= indexData.chunks - 1 ? 'none' : 'auto';
			}
		}

		async function goToChunk(n){
			if(n < 0 || n >= indexData.chunks) return;
			currentChunk = n;
			updateButtons();
			const entries = document.getElementById('entries');
			entries.innerHTML = '<div style="padding:20px;text-align:center;color:#999;">鍔犺浇涓?..</div>';
			await loadChunk(n);
			window.scrollTo({top: 0, behavior: 'smooth'});
		}

		async function loadChunk(n){ 
			const url = CHUNK_URL(n);
			let html = loaded.get(n) || '';
			console.log('寮€濮嬪姞杞?, url);
			try{ 
				if(!html){
					const r=await fetch(url, { cache: 'force-cache' }); 
					console.log('fetch 鍝嶅簲:', r.status, r.ok);
					if(!r.ok) throw new Error('HTTP ' + r.status); 
					html = await r.text(); 
					loaded.set(n, html);
				}
				console.log('鑾峰彇鍒?HTML锛岄暱搴?', html.length);
				const entries = document.getElementById('entries');
				entries.innerHTML = '';
				const wrapper = document.createElement('div'); 
				wrapper.className='entry-chunk'; 
				wrapper.innerHTML = html;
				
				const headingsForChunk = indexData.headings.filter(h=>h.chunk===n).sort((a,b)=>a.index-b.index);
				const h1s = wrapper.querySelectorAll('h1');
				console.log('鎵惧埌', h1s.length, '涓?h1 鏍囩锛屾湡鏈?, headingsForChunk.length, '涓?);
				for(let i=0;i<h1s.length && i<headingsForChunk.length;i++){ 
					try{ h1s[i].id = headingsForChunk[i].id; }catch(e){} 
				}
				
				// 娣诲姞 show 绫讳互浣垮崱鐗囧彲瑙侊紝骞朵负姣忎釜鍗＄墖娣诲姞澶嶅埗鎸夐挳
				const cards = wrapper.querySelectorAll('.entry-card');
				console.log('涓?, cards.length, '涓崱鐗囨坊鍔?show 绫诲拰澶嶅埗鎸夐挳');
				const titleCount = new Map();
				for(const card of cards){
					const h1 = card.querySelector('h1');
					if(!h1) continue;
					const key = (h1.textContent || '').trim();
					if(!key) continue;
					titleCount.set(key, (titleCount.get(key) || 0) + 1);
				}
				const titleSeq = new Map();
				for(let card of cards) {
					// 鍙鐞嗘湁 h1 鏍囬鐨勫崱鐗囷紝杩囨护鎺夊绔嬬殑瀛?
					const h1 = card.querySelector('h1');
					if(!h1) {
						// 娌℃湁 h1 鐨勫崱鐗囨槸瀛ょ珛瀛楋紝鐩存帴绉婚櫎
						card.remove();
						continue;
					}
					const edgeNodes = [card.firstChild, card.lastChild];
					for(const node of edgeNodes){
						if(!node || node.nodeType !== Node.TEXT_NODE) continue;
						const raw = node.textContent || '';
						const t = raw.trim();
						if(t && t.length <= 3 && !/[锛屻€傦紒锛燂紱锛?.!?;:\s]/u.test(t)){
							node.remove();
						}
					}

					// 鍏煎鍚庡崐鍒嗙墖閲屸€?u>闊虫爣</u> + 涓彜闊抽煹鍦颁綅琛ㄢ€濈殑鍐欐硶锛岀粺涓€琛ユ垚鈥滀笂鍙ら煶鈥濊〃鏍兼
					const underlinedIPA = card.querySelectorAll('u');
					for(const u of underlinedIPA){
						if(!u || !u.parentElement || u.closest('table')) continue;
						const ipa = (u.textContent || '').trim();
						if(!ipa) continue;
						const next = u.nextElementSibling;
						if(!next || next.tagName.toLowerCase() !== 'table') continue;
						const cap = next.querySelector('caption');
						const capText = (cap?.textContent || '').trim();
						if(!capText.includes('涓彜')) continue;

						const soundTable = document.createElement('table');
						soundTable.innerHTML = `<tr><th>涓婂彜闊?/th><td>${ipa}</td></tr>`;
						u.insertAdjacentElement('beforebegin', soundTable);
						u.remove();
					}
					
					card.classList.add('show');
					card.querySelector('.polyphony-note')?.remove();

					const key = (h1.textContent || '').trim();
					const total = titleCount.get(key) || 0;
					if(total > 1){
						const idx = (titleSeq.get(key) || 0) + 1;
						titleSeq.set(key, idx);
						const note = document.createElement('div');
						note.className = 'polyphony-note';
						note.textContent = `澶氶煶瀛?路 绗?${idx} 璇婚煶 / 鍏?${total} 璇婚煶`;
						h1.insertAdjacentElement('afterend', note);
					}

					const notes = card.querySelectorAll('p');
					for(const note of notes){
						const text = (note.textContent || '').replace(/\s+/g, ' ').trim();
						if(!text){
							note.remove();
							continue;
						}
						note.classList.add('entry-note');
					}

					// 娣诲姞澶嶅埗鎸夐挳
					if(!card.querySelector('.copy-btn')) {
						const copyBtn = document.createElement('button');
						copyBtn.className = 'copy-btn';
						copyBtn.textContent = '澶嶅埗';
						copyBtn.addEventListener('click', async (e) => {
							e.stopPropagation();
							const hid = card.querySelector('h1')?.id || '';
							const entryUrl = `${location.href.split('#')[0]}#${encodeURIComponent(hid)}`;
							const cardText = formatCardForCopy(card, entryUrl);
							try{
								await navigator.clipboard.writeText(cardText);
								copyBtn.classList.add('copied');
								copyBtn.textContent = '宸插鍒?;
								setTimeout(() => {
									copyBtn.classList.remove('copied');
									copyBtn.textContent = '澶嶅埗';
								}, 2000);
							}catch(err){
								console.error('澶嶅埗澶辫触:', err);
							}
						});
						card.appendChild(copyBtn);
					}
				}
				
				entries.appendChild(wrapper);
				console.log('鍧?, n, '鍔犺浇瀹屾垚');
			}catch(e){ 
				console.error('鍔犺浇澶辫触 chunk '+n, e);
				const entries = document.getElementById('entries');
				entries.innerHTML = '<div style="padding:20px;color:#d32f2f;text-align:center;">鍔犺浇澶辫触: ' + e.message + '</div>';
			}
		}

		document.addEventListener('DOMContentLoaded', async ()=>{
			const entries = document.getElementById('entries');
			if(!entries) {
				console.error('鏈壘鍒?#entries div');
				return;
			}
			
			console.log('寮€濮嬪姞杞?INDEX_PATH:', INDEX_PATH);
			indexData = await fetchJSON(INDEX_PATH);
			
			if(!indexData){ 
				console.error('绱㈠紩鏂囦欢鍔犺浇澶辫触');
				entries.innerHTML = '鉂?鏃犳硶鍔犺浇绱㈠紩鏂囦欢'; 
				return; 
			}
			
			console.log('绱㈠紩鍔犺浇鎴愬姛锛屾€诲潡鏁?', indexData.chunks);
			
			console.log('寮€濮嬪姞杞界涓€涓潡');
			await goToChunk(0);

			if(location.hash){ 
				const hid = decodeURIComponent(location.hash.slice(1)); 
				const target = indexData.headings.find(h=>h.id===hid); 
				if(target) await goToChunk(target.chunk);
			}

			const input = document.getElementById('search-input'); 
			const btn = document.getElementById('search-btn');
			
			// 鑾峰彇鎵€鏈夌箒浣撳瓧闆嗗悎锛堢敤浜庡揩閫熸煡鎵撅級
			const tradCharSet = new Set();
			const charToHeading = new Map(); // 瀛?-> 鏍囬瀵硅薄
			for(const h of indexData.headings){
				const title = h.title;
				if(title.length === 1) {
					tradCharSet.add(title);
					if(!charToHeading.has(title)) charToHeading.set(title, h);
				}
			}
			console.log('绱㈠紩涓殑绻佷綋瀛楁暟:', tradCharSet.size);
			
			function norm(s){ return (s||'').normalize('NFKC').trim(); }
			
			function findHeading(q){ 
				if(!q) return null;
				const qNorm = norm(q);
				
				// 鐩存帴鍦ㄧ储寮曚腑鏌ユ壘
				for(const h of indexData.headings){ 
					if(norm(h.title) === qNorm) {
						return h;
					}
					for(const v of h.variants||[]){ 
						if(norm(v) === qNorm) {
							return h;
						}
					}
				}
				
				return null; 
			}

			async function performSearch(){ 
				let q = (input.value||'').trim(); 
				if(!q) return;
				
				console.log('=== 鎼滅储寮€濮?===');
				console.log('杈撳叆:', q);
				
				// 鐢ㄦ埛搴旇鍦ㄥ乏杈归潰鏉胯浆鎹㈠悗锛屽湪鍙宠竟闈㈡澘鐩存帴杈撳叆绻佷綋瀛?
				const h = findHeading(q);
				
				if(!h){ 
					console.log('鉁?鏈壘鍒板尮閰嶉」');
					input.classList.add('no-result'); 
					setTimeout(()=>input.classList.remove('no-result'),600); 
					return; 
				}
				
				console.log('鉁?鎵惧埌:', h.title);
				console.log('=== 鎼滅储鎴愬姛 ===');
				await goToChunk(h.chunk);
				setTimeout(() => {
					const el = document.getElementById(h.id); 
					if(el){ 
						el.scrollIntoView({behavior:'smooth',block:'center'}); 
						el.classList.add('highlighted'); 
						setTimeout(()=>el.classList.remove('highlighted'),2000); 
						history.replaceState(null,'','#'+encodeURIComponent(h.id)); 
					}
				}, 100);
			}

			input.addEventListener('keydown', e=>{ if(e.key==='Enter') performSearch(); });
			btn.addEventListener('click', performSearch);

			// 鍙充晶缈婚〉鎸夐挳浜嬩欢缁戝畾
			const pagePrev = document.getElementById('page-prev');
			const pageNext = document.getElementById('page-next');

			if(pagePrev) pagePrev.addEventListener('click', () => goToChunk(currentChunk - 1));
			if(pageNext) pageNext.addEventListener('click', () => goToChunk(currentChunk + 1));

			updateButtons();
			loadArticleCatalog();
		});
	})();
	</script>
</head>
<body>
<script>
// 鍦?DOM 鍔犺浇鍓嶆娴嬭澶囩被鍨?
(function() {
	const isMobile = () => window.innerWidth <= 768;
	const updateDeviceClass = () => {
		if (isMobile()) {
			document.body.classList.add('mobile');
			document.body.classList.remove('desktop');
		} else {
			document.body.classList.add('desktop');
			document.body.classList.remove('mobile');
		}
	};
	updateDeviceClass();
	window.addEventListener('resize', updateDeviceClass);
	window.__isMobile = isMobile;
})();
</script>
<header class="topbar">
	<div class="brand">汉语古音手册</div>
	<div style="color:#e74c3c;font-size:12px;font-weight:500;margin-right:auto;" class="topbar-warning">※ 仅支持繁体字</div>
	<div class="search-wrap">
		<input id="search-input" placeholder="输入繁体字搜索" aria-label="搜索字">
		<button id="search-btn">查找</button>
	</div>
</header>
<button id="sidebar-mobile-toggle" class="side-fab" type="button" title="菜单">目录</button>
<a id="articles-mobile-btn" class="side-fab" href="articles.html" title="文章">文</a>
<div class="sidebar-overlay" id="sidebar-overlay"></div>

<div id="sidebar">
	<div class="sidebar-card">
		<div class="sidebar-cover-wrap">
			<img src="https://pic1.imgdb.cn/item/698dc2031d67521e9b492114.png" alt="汉语古音手册">
		</div>
		<button id="share-btn" type="button">分享当前页</button>
		<p class="sidebar-slogan">一字一源，纵览上古音系与中古音韵脉络。</p>
		<div class="sidebar-section">
			<div class="sidebar-section-title">
				<span>站内文章</span>
				<span id="article-count">加载中</span>
			</div>
			<ul id="article-list">
				<li class="article-loading">姝ｅ湪鍔犺浇鐩綍...</li>
			</ul>
			<a class="article-more" href="articles.html">鏌ョ湅鍏ㄩ儴鏂囩珷</a>
		</div>
	</div>
</div>

<div class="main-container">
	<div id="entries"></div>
</div>

<div style="height:30px"></div>

<footer class="site-footer">
	<div class="footer-content">
		<span class="footer-text">漏 2026 Takion Kroslin</span>
		<span class="footer-sep">|</span>
		<a href="https://github.com/TakionKroslin/dictionary" target="_blank" class="footer-link" title="GitHub" aria-label="GitHub">
			<svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
				<path d="M12 .5C5.65.5.5 5.66.5 12.02c0 5.09 3.3 9.41 7.88 10.94.58.1.79-.25.79-.56v-2.02c-3.2.69-3.88-1.55-3.88-1.55-.53-1.33-1.28-1.69-1.28-1.69-1.04-.71.08-.7.08-.7 1.15.09 1.75 1.18 1.75 1.18 1.01 1.75 2.67 1.24 3.33.95.1-.73.4-1.24.72-1.52-2.56-.29-5.25-1.28-5.25-5.69 0-1.26.45-2.3 1.18-3.11-.12-.29-.51-1.46.11-3.04 0 0 .96-.31 3.15 1.19a10.8 10.8 0 0 1 5.74 0c2.18-1.5 3.14-1.19 3.14-1.19.62 1.58.23 2.75.11 3.04.73.81 1.18 1.85 1.18 3.11 0 4.42-2.7 5.4-5.27 5.68.41.36.78 1.07.78 2.15v3.19c0 .31.21.67.8.56a11.54 11.54 0 0 0 7.87-10.94C23.5 5.66 18.35.5 12 .5z"/>
			</svg>
			<span>GitHub</span>
		</a>
	</div>
</footer>

<button id="scroll-to-top" class="side-fab" title="回到顶部">
	<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
		<polyline points="6 14 12 8 18 14"></polyline>
	</svg>
</button>
<button id="scroll-to-bottom" class="side-fab" title="到底部">
	<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
		<polyline points="6 14 12 8 18 14"></polyline>
	</svg>
</button>
<button id="page-prev" class="side-fab page-btn" title="上一页">
	<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
		<polyline points="15 18 9 12 15 6"></polyline>
	</svg>
</button>
<button id="page-next" class="side-fab page-btn" title="下一页">
	<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
		<polyline points="9 18 15 12 9 6"></polyline>
	</svg>
</button>

<script>
// 鍒嗕韩鎸夐挳鍔熻兘
const shareBtn = document.getElementById('share-btn');
if(shareBtn) {
	shareBtn.addEventListener('click', () => {
		const shareUrl = 'https://guyin.tahino.top/';
		navigator.clipboard.writeText(shareUrl).then(() => {
			shareBtn.classList.add('copied');
			shareBtn.textContent = '馃敆 閾炬帴宸插鍒?;
			setTimeout(() => {
				shareBtn.classList.remove('copied');
				shareBtn.textContent = '鍒嗕韩褰撳墠椤?;
			}, 3000);
		}).catch(err => console.error('澶嶅埗澶辫触:', err));
	});
}

// 鍥炲埌椤堕儴/搴曢儴鎸夐挳鍔熻兘
const scrollBtn = document.getElementById('scroll-to-top');
const scrollBottomBtn = document.getElementById('scroll-to-bottom');
const sidebarToggleBtn = document.getElementById('sidebar-mobile-toggle');
const sidebarOverlay = document.getElementById('sidebar-overlay');
window.addEventListener('scroll', () => {
	const maxScroll = document.documentElement.scrollHeight - window.innerHeight;
	if(window.scrollY > 300) {
		scrollBtn.classList.add('show');
	} else {
		scrollBtn.classList.remove('show');
	}
	if(window.scrollY < maxScroll - 300) {
		scrollBottomBtn.classList.add('show');
	} else {
		scrollBottomBtn.classList.remove('show');
	}
});
scrollBtn.addEventListener('click', () => {
	window.scrollTo({top: 0, behavior: 'smooth'});
});
scrollBottomBtn.addEventListener('click', () => {
	window.scrollTo({top: document.documentElement.scrollHeight, behavior: 'smooth'});
});

if(sidebarToggleBtn) {
	sidebarToggleBtn.addEventListener('click', () => {
		document.body.classList.toggle('sidebar-open');
	});
}
if(sidebarOverlay) {
	sidebarOverlay.addEventListener('click', () => {
		document.body.classList.remove('sidebar-open');
	});
}
window.addEventListener('resize', () => {
	if(window.innerWidth > 768) document.body.classList.remove('sidebar-open');
});
</script>

</body>
</html>

